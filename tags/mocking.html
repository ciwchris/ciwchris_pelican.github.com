<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>mocking - Notes to self</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="Notes to self" />
            <meta property="og:type" content="website"/>
            <meta property="og:title" content="Notes to self"/>
            <meta property="og:url" content="http://ciwchris.github.io"/>
            <meta property="og:description" content="Notes to self"/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://ciwchris.github.io/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://ciwchris.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://ciwchris.github.io/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://ciwchris.github.io/theme/css/style.css" type="text/css"/>
    <link rel="stylesheet" href="http://ciwchris.github.io/theme/css/main.css" type="text/css"/>

        <link href="http://ciwchris.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Notes to self ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://ciwchris.github.io/" class="navbar-brand">
Notes to self            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://ciwchris.github.io/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

            <article>
                <header class="page-header">
                    <h1>
                        <a href="http://ciwchris.github.io/blog/mocking-with-moq.html"
                            rel="bookmark"
                            title="Permalink to Mocking with Moq">
                            Mocking with Moq
                        </a>
                    </h1>
                </header>
                <div class="entry-content">
                    <div class="panel">
                        <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-03-04T21:29:00"> Mon 04 March 2013</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="http://ciwchris.github.io/tags/c.html">c#</a>
        /
	<a href="http://ciwchris.github.io/tags/mocking.html">mocking</a>
        /
	<a href="http://ciwchris.github.io/tags/tests.html">tests</a>
    
</footer><!-- /.post-info -->                        </div>
                    </div>
                    <p>Notes for the pluralsight course <a href="http://pluralsight.com/training/Courses/TableOfContents/mocking-with-moq">Mocking With Moq</a>.</p>
<h3>Unit tests should be</h3>
<ul>
<li><strong>Atomic:</strong> one small thing</li>
<li><strong>Deterministic:</strong> pass or fail</li>
<li><strong>Repeatable:</strong> shouldn't start failing if no code has changed</li>
<li><strong>Isolated and order independent:</strong> nothing should affect it</li>
<li><strong>Fast:</strong> milliseconds</li>
<li><strong>Easy to setup:</strong> shouldn't take a lot of coding</li>
</ul>
<h3>Samples</h3>
<figure class='code'>
<figcaption class='code-title'><span>Verify a method is called</span></figcaption>

<div class="highlight"><pre><span class="n">mockRepository</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;()));</span>

<span class="n">mockRepository</span><span class="p">.</span><span class="n">VerifyAll</span><span class="p">();</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Verify a method was called n times</span></figcaption>

<div class="highlight"><pre><span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;()),</span>
    <span class="n">Times</span><span class="p">.</span><span class="n">Exactly</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Mock return a value</span></figcaption>

<div class="highlight"><pre><span class="n">mockAddressBuilder</span>
    <span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">From</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">CustomerToCreateDto</span><span class="p">&gt;()))</span>
    <span class="p">.</span><span class="n">Returns</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">Address</span><span class="p">());</span>

<span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span><span class="n">y</span><span class="p">=&gt;</span><span class="n">y</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;()));</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Using an out parameter</span></figcaption>

<div class="highlight"><pre><span class="n">mockMailingAddressFactory</span>
    <span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(),</span> <span class="k">out</span> <span class="n">mailingAddress</span><span class="p">))</span>
    <span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;()));</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Change the return value after each call to the mocked member</span></figcaption>

<div class="highlight"><pre><span class="n">mockIdFactory</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Create</span><span class="p">())</span>
    <span class="p">.</span><span class="n">Returns</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Callback</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">++);</span>

<span class="n">mockIdFactory</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Create</span><span class="p">(),</span> <span class="n">Times</span><span class="p">.</span><span class="n">AtLeastOnce</span><span class="p">());</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Verify the arguments passed to the mocked method are as expected</span></figcaption>

<div class="highlight"><pre><span class="n">mockFullNameBuilder</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span>
    <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">From</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(),</span> <span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()));</span>

<span class="n">mockFullNameBuilder</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">From</span><span class="p">(</span>
    <span class="n">It</span><span class="p">.</span><span class="n">Is</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span>
        <span class="n">fn</span><span class="p">=&gt;</span><span class="n">fn</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">customerToCreateDto</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
            <span class="n">StringComparison</span><span class="p">.</span><span class="n">InvariantCultureIgnoreCase</span><span class="p">)),</span>
    <span class="n">It</span><span class="p">.</span><span class="n">Is</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span>
        <span class="n">fn</span><span class="p">=&gt;</span><span class="n">fn</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">customerToCreateDto</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
            <span class="n">StringComparison</span><span class="p">.</span><span class="n">InvariantCultureIgnoreCase</span><span class="p">))));</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Conditionally return a value, control code flow</span></figcaption>

<div class="highlight"><pre><span class="n">mockCustomerStatusFactory</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span>
    <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CreateFrom</span><span class="p">(</span>
        <span class="n">It</span><span class="p">.</span><span class="n">Is</span><span class="p">&lt;</span><span class="n">CustomerToCreateDto</span><span class="p">&gt;(</span>
            <span class="n">y</span> <span class="p">=&gt;</span> <span class="n">y</span><span class="p">.</span><span class="n">DesiredStatus</span> <span class="p">==</span> <span class="n">CustomerStatus</span><span class="p">.</span><span class="n">Platinum</span><span class="p">)))</span>
    <span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">CustomerStatus</span><span class="p">.</span><span class="n">Platinum</span><span class="p">);</span>

<span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span>
    <span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">SaveSpecial</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;()));</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Throw an exception</span></figcaption>

<div class="highlight"><pre><span class="n">mockCustomerAddressFactory</span>
    <span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">From</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">CustomerToCreateDto</span><span class="p">&gt;()))</span>
    <span class="p">.</span><span class="n">Throws</span><span class="p">&lt;</span><span class="n">InvalidCustomerAddressException</span><span class="p">&gt;();</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Verify a setter has been set</span></figcaption>

<div class="highlight"><pre><span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">VerifySet</span><span class="p">(</span>
    <span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">LocalTimeZone</span> <span class="p">=</span> <span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;());</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Verify a getter has been called</span></figcaption>

<div class="highlight"><pre><span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">WorkstationId</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="m">123</span><span class="p">);</span>

<span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">VerifyGet</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">WorkstationId</span><span class="p">);</span>
</pre></div>


</figure>

<p>For nested objects you don't have to mock each object; Moq will automatically return a mocked object if it can.</p>
<figure class='code'>
<figcaption class='code-title'><span>Recursive/nested properties, Moq realizes each is mockable and so will return a mock for each</span></figcaption>

<div class="highlight"><pre><span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span>
    <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">SystemConfiguration</span><span class="p">.</span><span class="n">AuditingInformation</span><span class="p">.</span><span class="n">WorkstationId</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="m">123</span><span class="p">);</span>

<span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">VerifyGet</span><span class="p">(</span>
    <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">SystemConfiguration</span><span class="p">.</span><span class="n">AuditingInformation</span><span class="p">.</span><span class="n">WorkstationId</span><span class="p">);</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Stub a property</span></figcaption>

<div class="highlight"><pre><span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">SetupProperty</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">WorkstationId</span><span class="p">,</span> <span class="m">1234</span><span class="p">);</span>

<span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">VerifyGet</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">WorkstationId</span><span class="p">);</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Stub all properties</span></figcaption>

<div class="highlight"><pre><span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">SetupAllProperties</span><span class="p">();</span>
<span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">WorkstationId</span> <span class="p">=</span> <span class="m">2345</span><span class="p">;</span>

<span class="n">mockApplicationSettings</span><span class="p">.</span><span class="n">VerifyGet</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">WorkstationId</span><span class="p">);</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Event</span></figcaption>

<div class="highlight"><pre><span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">Raise</span><span class="p">(</span>
    <span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">NotifySalesTeam</span> <span class="p">+=</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">new</span> <span class="nf">NotifySalesTeamEventArgs</span><span class="p">(</span><span class="s">&quot;jim&quot;</span><span class="p">));</span>

<span class="n">mockMailingRepository</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span>
    <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">NewCustomerMessage</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()));</span>
</pre></div>


</figure>

<figure class='code'>
<figcaption class='code-title'><span>Custom event</span></figcaption>

<div class="highlight"><pre><span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">Raise</span><span class="p">(</span>
    <span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">NotifySalesTeam</span> <span class="p">+=</span> <span class="k">null</span><span class="p">,</span>
    <span class="s">&quot;jim&quot;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

<span class="n">mockMailingRepository</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span>
    <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">NewCustomerMessage</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()));</span>
</pre></div>


</figure>

<p>Two types of mocks:</p>
<ol>
<li><strong>Loose:</strong> if the object doesn't have any expectations set it will return the default value for the object. It will not throw an exception when verify is called. This is the default behavior for Moq</li>
<li><strong>Strict:</strong> exception will be thrown if the object hasn't been explicitly setup.</li>
</ol>
<figure class='code'>
<figcaption class='code-title'><span>Strict mock behavior</span></figcaption>

<div class="highlight"><pre><span class="kt">var</span> <span class="n">mockCustomerRepository</span> <span class="p">=</span> 
    <span class="k">new</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">ICustomerRepository</span><span class="p">&gt;(</span><span class="n">MockBehavior</span><span class="p">.</span><span class="n">Strict</span><span class="p">);</span>
<span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;()));</span>

<span class="n">mockCustomerRepository</span><span class="p">.</span><span class="n">Verify</span><span class="p">();</span>
</pre></div>


</figure>

<p><strong>Partial mock:</strong> allows invocation of a base class implementation</p>
<figure class='code'>
<figcaption class='code-title'><span>Mock the SUT when working with a base class</span></figcaption>

<div class="highlight"><pre><span class="n">mockNameFormatter</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">From</span><span class="p">(</span><span class="k">new</span> <span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span> <span class="s">&quot;SAPBuilder&quot;</span><span class="p">));</span>

<span class="n">mockNameFormatter</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span>
    <span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">ParseBadWordsFrom</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()),</span>
    <span class="n">Times</span><span class="p">.</span><span class="n">Exactly</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>
</pre></div>


</figure>

<p><strong>Recursive:</strong> Set the default value of a mock to return a mocked object, <code>DefaultValue = DefaultValue.Mock</code>, instead of the object's default value, this only works if  the object is mockable. Then use <code>Mock.Get()</code> to retrieve the actual mock which can then be used like any other mocked object</p>
<figure class='code'>
<figcaption class='code-title'><span>Recursive mock</span></figcaption>

<div class="highlight"><pre><span class="kt">var</span> <span class="n">mockAddressFormatterFactory</span> <span class="p">=</span> 
    <span class="k">new</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">IAddressFormatterFactory</span><span class="p">&gt;</span> 
        <span class="p">{</span><span class="n">DefaultValue</span> <span class="p">=</span> <span class="n">DefaultValue</span><span class="p">.</span><span class="n">Mock</span><span class="p">};</span>
<span class="kt">var</span> <span class="n">addressFormatter</span> <span class="p">=</span> <span class="n">mockAddressFormatterFactory</span>
    <span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">From</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;());</span>
<span class="kt">var</span> <span class="n">mock</span> <span class="p">=</span> <span class="n">Mock</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="n">addressFormatter</span><span class="p">);</span>

<span class="n">mock</span><span class="p">.</span><span class="n">Verify</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">From</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="n">CustomerToCreateDto</span><span class="p">&gt;()));</span>
</pre></div>


</figure>

<p>Use a mock factory when working with lots of dependencies. This centralizes the creation and verification of all mock objects.</p>
<figure class='code'>
<figcaption class='code-title'><span>Mock factory</span></figcaption>

<div class="highlight"><pre><span class="kt">var</span> <span class="n">mockFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MockRepository</span><span class="p">(</span><span class="n">MockBehavior</span><span class="p">.</span><span class="n">Loose</span><span class="p">)</span> 
                <span class="p">{</span><span class="n">DefaultValue</span> <span class="p">=</span> <span class="n">DefaultValue</span><span class="p">.</span><span class="n">Mock</span><span class="p">};</span>
<span class="kt">var</span> <span class="n">mockCustomerRepository</span> <span class="p">=</span> 
    <span class="n">mockFactory</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="n">ICustomerRepository</span><span class="p">&gt;();</span>
<span class="kt">var</span> <span class="n">mockCustomerAddressFormatter</span> <span class="p">=</span> 
    <span class="n">mockFactory</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="n">ICustomerAddressFormatter</span><span class="p">&gt;();</span>

<span class="n">mockFactory</span><span class="p">.</span><span class="n">Verify</span><span class="p">();</span>
</pre></div>


</figure>

<p>When mocking protected members the member must be marked as virtual. You lose intellisense, method name must appear in a string. Must use <code>ItExpr</code> instead of <code>It</code>.</p>
<figure class='code'>
<figcaption class='code-title'><span>Protected members</span></figcaption>

<div class="highlight"><pre><span class="n">mockCustomerNameFormatter</span><span class="p">.</span><span class="n">Protected</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Setup</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">&quot;ParseBadWordsFrom&quot;</span><span class="p">,</span> <span class="n">ItExpr</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;())</span>
    <span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="s">&quot;asdf&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Verifiable</span><span class="p">();</span>

<span class="n">mockCustomerNameFormatter</span><span class="p">.</span><span class="n">Verify</span><span class="p">();</span>
</pre></div>


</figure>
                </div>
            </article>
            <hr/>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">



                <li class="list-group-item"><a href="http://ciwchris.github.io/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group " id="tags">
                        <li class="list-group-item tag-1">
                            <a href="http://ciwchris.github.io/tags/vim.html">
                                vim
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://ciwchris.github.io/tags/powershell.html">
                                powershell
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://ciwchris.github.io/tags/craftsmanship.html">
                                craftsmanship
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://ciwchris.github.io/tags/testing.html">
                                testing
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://ciwchris.github.io/tags/c.html">
                                c#
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://ciwchris.github.io/tags/tests.html">
                                tests
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://ciwchris.github.io/tags/philosophy.html">
                                philosophy
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://ciwchris.github.io/tags/clojurescript-angular.html">
                                clojurescript angular
                            </a>
                        </li>
                    </ul>
                </li>    

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2013 Chris
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://ciwchris.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://ciwchris.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://ciwchris.github.io/theme/js/respond.min.js"></script>

</body>
</html>